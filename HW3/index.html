<!DOCTYPE html>
<html>
<head>
  <title>Harry Chong's Weather Program</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	
  <script type="text/javascript" src="weather.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>

<body>
<div class="bar">
  <nav class="navbar navbar-dark bg-dark">
    <h2 style="color: white"> 7 Day Forecast </h2>
  </nav>
</div>

<div class="container-fluid">
  <div class="row"> 
    <table class="table table-striped">
	  <thead class="thead-dark">
        <th>Day</th>
        <th>High/Low</th>
        <th>Feels</th>
        <th>Precip</th>
        <th>Humidity</th>
        <th>Description</th>
        <th></th>	
      </thead>
      <tbody style="font-weight: bold" id="body">
      </tbody>
     </table> 
</div> 
</div>

<script>
// Get Location and Weather
function getInfo() {
  navigator.geolocation.getCurrentPosition(success, error);
	 
  function success(pos) {
	var lat = pos.coords.latitude;
	var lon = pos.coords.longitude;
	document.getElementById('header').innerHTML = "Your Information:";
	document.getElementById('latitude').innerHTML = "Lat: " + lat;
	document.getElementById('longitude').innerHTML = "Lon: " + lon;
		
    requestWeather(lat, lon);
  }

  function requestWeather(lat, lon) {
	var URL = "./getweather";
	  $.ajax({
        type: "GET",
        url: URL,
        dataType: "text",
        timeout: 3000,
        data : {"lat": lat,
                "lon": lon},
        success : function(msg){
          var data = JSON.parse(msg)
          // console.log(msg);
		  // console.log(data);

		  var time_arr = data[0]
		  var weather_des_arr = data[1]
		  var minTemp_arr = data[2]
		  var maxTemp_arr = data[3]
		  var icon_arr = data[4]
		  var feelsLikeF_arr = data[5]
		  var pop = data[6]
		  var humidity = data[7]
			
		  var tbody = $('#body');
		  var count = 0;
		  var totalCells = 1;
		  
		  // Fill Table
		  for (var i = 0; i < 7; i++) {
            var tr = $('<tr/>').appendTo(tbody);
            tr.append('<td class="table-light">' + time_arr[count] + '</td' + '</td>');
            tr.append('<td class="table-light">' + maxTemp_arr[count] + "° / " + minTemp_arr[count] + '°</td>');
			tr.append('<td class="table-light">' + feelsLikeF_arr[count] + '°</td>');
			tr.append('<td class="table-light">' + pop[count] + '%</td>');
			tr.append('<td class="table-light">' + humidity[count] + '%</td>');
			tr.append('<td class="table-light">' + weather_des_arr[count] + '</td>');
			tr.append('<td class="table-light"><img src="/css/icons/' +  icon_arr[count] + '"alt="" hspace="50" height=50 width=50></img></td>');
            count++;
			
          } 

           /*$("#current").html(msg);
           console.log(time_arr);
           console.log(weather_des_arr);
           console.log(minTemp_arr);
           console.log(maxTemp_arr);
           console.log(icon_arr);*/
		},
		error: function(jgXHR, textStatus, errorThrown) {
			alert("Error: " + textStatus + " " + errorThrown);
			error() 
		}
	});
  }
	
  function error() {
    document.getElementById('current').innerHTML = "There was an error! Please try again later.";
  }
}
</script>

<div>
  <button type="button" class="btn btn-primary btn-lg btn-block" onclick="resetTable(); getInfo();">Get Weather Forecast!</button>
  <p id="current"></p>
  <h3 id="header"></h3> 
  <p id="latitude"></p> 
  <p id="longitude"></p>
</div>

</body>
</html>
